(function (f) {
    "function" === typeof define && define.amd ? "undefined" !== typeof jQuery ? define(["jquery"], f) : define([], f) : "undefined" !== typeof jQuery ? f(jQuery) : f()
})(function (f, n) {
    function t(b, c) {
        for (var a = decodeURI(b), a = u[c ? "strict" : "loose"].exec(a), d = {attr: {}, param: {}, seg: {}}, h = 14; h--;)d.attr[v[h]] = a[h] || "";
        d.param.query = q(d.attr.query);
        d.param.fragment = q(d.attr.fragment);
        d.seg.path = d.attr.path.replace(/^\/+|\/+$/g, "").split("/");
        d.seg.fragment = d.attr.fragment.replace(/^\/+|\/+$/g, "").split("/");
        d.attr.base =
            d.attr.host ? (d.attr.protocol ? d.attr.protocol + "://" + d.attr.host : d.attr.host) + (d.attr.port ? ":" + d.attr.port : "") : "";
        return d
    }

    function w(b) {
        b = b.tagName;
        return"undefined" !== typeof b ? x[b.toLowerCase()] : b
    }

    function r(b, c, a, d) {
        var h = b.shift();
        if (h) {
            var e = c[a] = c[a] || [];
            if ("]" == h)if (l(e))"" != d && e.push(d); else if ("object" == typeof e) {
                c = b = e;
                a = [];
                for (prop in c)c.hasOwnProperty(prop) && a.push(prop);
                b[a.length] = d
            } else c[a] = [c[a], d]; else {
                ~h.indexOf("]") && (h = h.substr(0, h.length - 1));
                if (!s.test(h) && l(e))if (0 == c[a].length)e =
                    c[a] = {}; else {
                    var e = {}, g;
                    for (g in c[a])e[g] = c[a][g];
                    c[a] = e
                }
                r(b, e, h, d)
            }
        } else l(c[a]) ? c[a].push(d) : c[a] = "object" == typeof c[a] ? d : "undefined" == typeof c[a] ? d : [c[a], d]
    }

    function q(b) {
        return y(String(b).split(/&|;/),function (c, a) {
            try {
                a = decodeURIComponent(a.replace(/\+/g, " "))
            } catch (d) {
            }
            var b = a.indexOf("="), e;
            a:{
                for (var g = a.length, f, m = 0; m < g; ++m)if (f = a[m], "]" == f && (e = !1), "[" == f && (e = !0), "=" == f && !e) {
                    e = m;
                    break a
                }
                e = void 0
            }
            g = a.substr(0, e || b);
            e = a.substr(e || b, a.length);
            e = e.substr(e.indexOf("=") + 1, e.length);
            "" == g && (g =
                a, e = "");
            b = g;
            g = e;
            if (~b.indexOf("]")) {
                var k = b.split("[");
                r(k, c, "base", g)
            } else {
                if (!s.test(b) && l(c.base)) {
                    e = {};
                    for (k in c.base)e[k] = c.base[k];
                    c.base = e
                }
                k = c.base;
                e = k[b];
                n === e ? k[b] = g : l(e) ? e.push(g) : k[b] = [e, g]
            }
            return c
        }, {base: {}}).base
    }

    function y(b, c, a) {
        for (var d = 0, f = b.length >> 0; d < f;)d in b && (a = c.call(n, a, b[d], d, b)), ++d;
        return a
    }

    function l(b) {
        return"[object Array]" === Object.prototype.toString.call(b)
    }

    function p(b, c) {
        1 === arguments.length && !0 === b && (c = !0, b = n);
        b = b || window.location.toString();
        return{data: t(b,
            c || !1), attr: function (a) {
            a = z[a] || a;
            return"undefined" !== typeof a ? this.data.attr[a] : this.data.attr
        }, param: function (a) {
            return"undefined" !== typeof a ? this.data.param.query[a] : this.data.param.query
        }, fparam: function (a) {
            return"undefined" !== typeof a ? this.data.param.fragment[a] : this.data.param.fragment
        }, segment: function (a) {
            if ("undefined" === typeof a)return this.data.seg.path;
            a = 0 > a ? this.data.seg.path.length + a : a - 1;
            return this.data.seg.path[a]
        }, fsegment: function (a) {
            if ("undefined" === typeof a)return this.data.seg.fragment;
            a = 0 > a ? this.data.seg.fragment.length + a : a - 1;
            return this.data.seg.fragment[a]
        }}
    }

    var x = {a: "href", img: "src", form: "action", base: "href", script: "src", iframe: "src", link: "href"}, v = "source protocol authority userInfo user password host port relative path directory file query fragment".split(" "), z = {anchor: "fragment"}, u = {strict: /^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/, loose: /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},
        s = /^[0-9]+$/;
    "undefined" !== typeof f ? (f.fn.url = function (b) {
        var c = "";
        this.length && (c = f(this).attr(w(this[0])) || "");
        return p(c, b)
    }, f.url = p) : window.purl = p
});
