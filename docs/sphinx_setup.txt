0. Requirements
================

To enable searching via Sphinx on your Beehive Forum you are going to need:

 - Sphinx Search version 2.0.1-beta.
 - Beehive Forum 1.1.0.
 - The ability to edit sphinx.conf and add new indexes.


1. Install Sphinx
=================

Beehive Forum requires Sphinx 2.0.1-beta or newer. If your package manager
doesn't provide a new enough version of Sphinx (or your OS doesn't provide
a package manager) you can download the source and / or binaries from:

  http://sphinxsearch.com/downloads/beta/

Once you have downloaded Sphinx follow the instructions for installing it.

2. Setting up Sphinx
====================

To make Beehive work with Sphinx you need to enable MySQL protocol support,
hence the requirement for 2.0.1-beta. To do this you need to ensure your
sphinx.conf contains a listen directive which reads:

  listen = 9306:mysql41

9306 is the port Sphinx will listen on for MySQL protocol connections. You 
can change this if you want, but don't change it to the same port as the 
real MySQL as that would be really, really silly.

As an example, here is the entire searchd section of the sphinx.conf as used
on Teh Forum:


    searchd
    {
        listen              = 9312
        listen              = 9306:mysql41

        log                 = /var/log/searchd.log

        query_log           = /var/log/query.log

        read_timeout        = 5

        client_timeout      = 30

        max_children        = 10

        pid_file            = /var/log/searchd.pid

        max_matches         = 1000

        seamless_rotate     = 1

        preopen_indexes     = 0

        unlink_old          = 1

        workers             = threads
    }


In addition to the listen directive changes you also need to create an index
in Sphinx for your Beehive Forum installation to index it's posts in. The name
of the index can be whatever you choose, for simplicity sake it is shown here
as 'beehiveforum'.

Again, here is the index section from Teh Forum that you can use as reference:


    index beehiveforum
    {
        type              = rt

        path              = /var/data/sphinx/beehive

        rt_field          = title
        rt_field          = content

        rt_attr_uint      = forum
        rt_attr_uint      = fid
        rt_attr_uint      = tid
        rt_attr_uint      = pid
        rt_attr_uint      = by_uid
        rt_attr_uint      = from_uid
        rt_attr_uint      = to_uid

        rt_attr_timestamp = created

        charset_type      = utf-8

        html_strip        = 1
    }


Please feel free to change the path directive, this is where Sphinx will store
the physical index files, but please, please don't change anything else about
the index definition (except its name of course). If you do change anything your
Beehive Forum may not be able to communicate with Sphinx.

Good job, Sphinx is now all set up and ready to rock and roll with your Beehive
Forum. All that is left to do for this step is to start the Sphinx searchd daemon
as per the Sphinx documentation for your OS.


3. Enabling Sphinx support in Beehive Forum
===========================================

To enable Sphinx support in your Beehive Forum, simply visit the Global Forum 
Settings of your Beehive Forum and look for the Sphinx Search Integration section.
Here you will find 3 text fields where you can enter the Sphinx index name you
created in your sphinx.conf and the Sphinx server address and port number.

Additionally there is a set of radio buttons to quickly and easily enable or 
disable the integration.

Once you've entered the values, scroll to the bottom and click save.


4. Filling the Sphinx index
===========================

Once Sphinx support is enabled on your Beehive Forum any new threads and posts 
will be automatically indexed. However, any threads and posts created before the 
switch-on will not be indexed and thus will be unsearchable.

If you're enabling Sphinx for an existing well established Beehive Forum, you'll
probably be want to index all the old threads and posts and not just new ones.
Fortunately, we've made this easy by the inclusion of a PHP script you can run
from the shell named update_sphinx_index.php

You will find this script in the main forum folder. To run it simply use the CLI
version of PHP from a shell / Command Prompt, i.e.:

    php update_sphinx_update.php

This script may take quite a while to run, if you're on Linux it is recommended
you make use of screen (or byobu) to run this in a detatachable window that you
can come back to later to check on.

Note that you will only need to run this script once. After it is run, new posts 
will automatically be added to the index. If they don't then something has gone
wrong with your configuration or you've found bug.


5. Help. It didn't work!
========================

Don't panic! Pop over to Teh Forum (http://www.tehforum.co.uk) and ask for help. 
Please help us to help you by indicating any error messages you received and how 
far along this guide you've manage to get. 

Please be paitient in getting a reply, we'll try to get to you ASAP, but please 
be aware that we don't monitor the forum 24/7 (it's our hobby, not our job), so 
you might have to wait for someone to wake up, make a quick visit to the bathroom,
check their emails / twitter / facebook and have some breakfast before they even
think about get around to logging on to the forum.

If you don't get a reply without 24 hours then you can feel free to bump the
thread.